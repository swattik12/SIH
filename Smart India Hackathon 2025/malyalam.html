<!DOCTYPE html>
<html lang="ml">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>เดเด เดธเดนเดพเดฏเดฟ</title>
    <link rel="stylesheet" href="chatbot.css" />
    <link rel="Website Icon" href="./Images/Logo.jpg" />
  </head>
  <body>
    <header>
      <div>
        <img src="./Images/Logo.jpg" alt="Logo" />
        <h1>เดเตผเดทเด เดธเตเดนเตเดคเตเดคเต</h1>
      </div>
      <div>
        <button onclick="english()">๐ English</button>
        <button>เดฒเตเดเตเดเดเตเดเต</button>
      </div>
    </header>

    <div class="dashboard">
      <div class="card ai-assistant">
        <div>
          <h2>๐ฌ เดเด เดธเดนเดพเดฏเดฟ</h2>
          <div class="chat-box">
            เดนเดฒเต! เดเดพเตป เดจเดฟเดเตเดเดณเตเดเต เดเด เดเดพเตผเดทเดฟเด เดธเดนเดพเดฏเดฟ. เดเตเดเดจเดฟเดฏเดจเตเดคเตเดฐเดฃเด, เดเดพเดฒเดพเดตเดธเตเดฅ เดเดชเดฆเตเดถเด,
            เดตเดฟเดณ เดชเดฐเดฟเดชเดพเดฒเดจเด, เดธเตผเดเตเดเดพเตผ เดชเดฆเตเดงเดคเดฟเดเตพ เดเดจเตเดจเดฟเดตเดฏเตเดเตเดเตเดฑเดฟเดเตเดเต เดเตเดฆเดฟเดเตเดเดพเด.
          </div>
        </div>
        <div>
          <div class="upload">
            เดเตเด/เดฐเตเดเด เดเดฃเตเดเตเดคเตเดคเดพเตป เดตเดฟเดณเดฏเตเดเต เดเดฟเดคเตเดฐเด เดเดชเตโเดฒเตเดกเต เดเตเดฏเตเดฏเตเด
          </div>
          <div class="input-area">
            <input
              type="text"
              placeholder="เดจเดฟเดเตเดเดณเตเดเต เดเดพเตผเดทเดฟเด เดเตเดฆเตเดฏเด เดเตเดฆเดฟเดเตเดเต..."
            />
            <button>โค</button>
          </div>
          <div class="extra-buttons">
            <button id="voiceBtn">๐ค เดถเดฌเตเดฆ เดเตปเดชเตเดเตเดเต</button>
            <button id="photoBtn">๐ท เดซเตเดเตเดเต</button>
          </div>
          <div id="capturedMedia"></div>
        </div>
      </div>

      <div class="card advice">
        <h2>๐ก เดตเตเดฏเดเตเดคเดฟเดเดค เดเดชเดฆเตเดถเด</h2>
        <h3>เดเดจเตเดจเดคเตเดคเต เดเดชเดฆเตเดถเด</h3>

        <div class="alert">
          <strong>เดเดพเดฒเดพเดตเดธเตเดฅ เดฎเตเดจเตเดจเดฑเดฟเดฏเดฟเดชเตเดชเต</strong>
          <span class="badge urgent">เดคเตฝเดเตเดทเดฃเด</span>
          <p>
            2 เดฆเดฟเดตเดธเดคเตเดคเดฟเดจเตเดณเตเดณเดฟเตฝ เดถเดเตเดคเดฎเดพเดฏ เดฎเดด เดชเตเดฐเดคเตเดเตเดทเดฟเดเตเดเตเดจเตเดจเต. เดจเตเตฝเดชเตเดชเดพเดเดเตเดเตพเดเตเดเดพเดฏเดฟ
            เดกเตเดฐเตเดฏเดฟเดจเตเดเต เดเดฐเตเดเตเดเตเด.
          </p>
          <button>เดกเตเดฐเตเดฏเดฟเดจเตเดเต เดชเดฐเดฟเดถเตเดงเดฟเดเตเดเตเด โฌ</button>
        </div>

        <div class="opportunity">
          <strong>เดตเดฟเดชเดฃเดฟ เดตเดฟเดฒ เดฎเตเดจเตเดจเดฑเดฟเดฏเดฟเดชเตเดชเต</strong>
          <span class="badge success">เดเดตเดธเดฐเด</span>
          <p>เด เดเดดเตเด เดคเตเดเตเดเดฏเตเดเต เดตเดฟเดฒ 15% เดเตเดเตเดคเดฒเดพเดฃเต. เดตเดฟเดฑเตเดฑเดดเดฟเดเตเดเดพเตป เดจเดฒเตเดฒ เดธเดฎเดฏเด.</p>
          <button>เดตเดฟเดชเดฃเดฟเดเตพ เดเดพเดฃเตเด โฌ</button>
        </div>

        <button class="view-all">เดเดฒเตเดฒเดพ เดเดชเดฆเตเดถเดเตเดเดณเตเด เดเดพเดฃเตเด</button>
      </div>
    </div>

    <div class="container">
      <div class="grid">
        <div class="card">
          <h2>เดเดพเดฒเดพเดตเดธเตเดฅ เดชเตเดฐเดตเดเดจเด</h2>
          <div id="weather">เดเดพเดฒเดพเดตเดธเตเดฅ เดฒเตเดกเต เดเตเดฏเตเดฏเตเดจเตเดจเต...</div>
        </div>

        <div class="card">
          <h2>เดจเดฟเดฒเดตเดฟเดฒเต เดตเดฟเดณเดเตพ</h2>
          <div>
            <select id="cropSelect">
              <option value="">๐ฑ เดเตเตผเดเตเดเดพเตป เดตเดฟเดณ เดคเดฟเดฐเดเตเดเตเดเตเดเตเดเตเด</option>
              <option>๐พ เดเดฐเดฟ</option>
              <option>๐ฅฅ เดคเตเดเตเด</option>
              <option>๐ฟ เดเตเดคเดฎเตเดชเต</option>
              <option>๐ฝ เดเตเดณเด</option>
              <option>๐ฌ เดเดฐเดฟเดฎเตเดชเต</option>
            </select>
            <button class="add-btn" onclick="addCrop()">+</button>
          </div>

          <div id="addedCrops" class="crop-list">
            เดตเดฟเดฒเดเตพ เดเดจเตเดจเตเด เดเตเตผเดคเตเดคเดฟเดเตเดเดฟเดฒเตเดฒ
          </div>
        </div>

        <div class="card">
          <h2>เดธเตผเดเตเดเดพเตผ เดชเดฆเตเดงเดคเดฟเดเตพ</h2>
          <div class="scheme">
            <b>เดชเดฟ.เดเด-เดเดฟเดธเดพเตป เดชเดฆเตเดงเดคเดฟ</b><span>เดธเดเตเดตเด</span>
            <p>เดเตผเดทเดเตผเดเตเดเต เดจเตเดฐเดฟเดเตเดเตเดณเตเดณ เดตเดฐเตเดฎเดพเดจ เดธเดนเดพเดฏเด</p>
            <small>โน6,000/เดตเตผเดทเด โข เดเดตเดธเดพเดจ เดคเตเดฏเดคเดฟ: 31-10-2025</small>
            <button>เดตเดฟเดถเดฆเดพเดเดถเดเตเดเตพ เดเดพเดฃเตเด</button>
          </div>
          <div class="scheme">
            <b>เดเดฟเดธเดพเตป เดเตเดฐเตเดกเดฟเดฑเตเดฑเต เดเดพเตผเดกเต</b><span>เดธเดเตเดตเด</span>
            <p>เดเตเดฑเดเตเด เดชเดฒเดฟเดถเดฏเตเดณเตเดณ เดเดพเตผเดทเดฟเด เดตเดพเดฏเตเดชเดเตพ</p>
            <small>โน3 เดฒเดเตเดทเด เดตเดฐเต โข เดเดตเดธเดพเดจ เดคเตเดฏเดคเดฟ: 31-12-2025</small>
            <button>เดตเดฟเดถเดฆเดพเดเดถเดเตเดเตพ เดเดพเดฃเตเด</button>
          </div>
          <button style="width: 100%; margin-top: 10px" class="add-btn">
            เดเดฒเตเดฒเดพ เดชเดฆเตเดงเดคเดฟเดเดณเตเด เดเดพเดฃเตเด
          </button>
        </div>
      </div>
    </div>

    <footer>
      ยฉ 2025 เดเตผเดทเด เดธเตเดนเตเดคเตเดคเต. เดเดฒเตเดฒเดพ เดเดตเดเดพเดถเดเตเดเดณเตเด เดธเดเดฐเดเตเดทเดฟเดเตเดเดฟเดฐเดฟเดเตเดเตเดจเตเดจเต.
    </footer>

    <script>
      const apiKey = "24d2ff1f208067958e8e4ab1dbf30bf1";
      const weatherDiv = document.getElementById("weather");
      const addedCrops = document.getElementById("addedCrops");
      let crops = [];

      // Render crops in Malayalam
      function renderCrops() {
        if (crops.length === 0) {
          addedCrops.innerHTML = "เดเดคเตเดตเดฐเต เดตเดฟเดณเดเตพ เดเตเตผเดคเตเดคเดฟเดเตเดเดฟเดฒเตเดฒ";
          return;
        }
        addedCrops.innerHTML = crops.map((c) => `<span>${c}</span>`).join(" ");
      }

      function addCrop() {
        const cropSelect = document.getElementById("cropSelect");
        const selectedCrop = cropSelect.value;

        if (selectedCrop && !crops.includes(selectedCrop)) {
          crops.push(selectedCrop);
          renderCrops();
        }
        cropSelect.value = "";
      }
      async function fetchWeather(lat, lon) {
        try {
          const res = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`
          );
          const data = await res.json();

          if (!data.list) {
            weatherDiv.innerHTML = "เดเดพเดฒเดพเดตเดธเตเดฅ เดฒเดญเตเดฏเดฎเดฒเตเดฒ.";
            return;
          }

          // Pick 1 forecast per day (every 8 entries = 24 hours)
          const forecast = data.list.filter((_, i) => i % 8 === 0).slice(0, 4);

          weatherDiv.innerHTML = forecast
            .map(
              (f, i) => `
      <div class="forecast-item">
        <div><b>${i === 0 ? "เดเดจเตเดจเต" : "เดฆเดฟเดตเดธเด " + i}</b></div>
        <img src="https://openweathermap.org/img/wn/${
          f.weather[0].icon
        }@2x.png" width="50"/>
        <div style="font-size:20px;">${Math.round(f.main.temp)}ยฐC</div>
        <div>${f.weather[0].main}</div>
        <small>๐ง${f.main.humidity}% โข ๐${Math.round(
                f.wind.speed * 3.6
              )} km/h</small>
      </div>`
            )
            .join("");
        } catch (e) {
          weatherDiv.innerHTML = "เดเดพเดฒเดพเดตเดธเตเดฅเดฏเดฟเตฝ เดชเดฟเดดเดตเต เดธเดเดญเดตเดฟเดเตเดเต.";
          console.error(e);
        }
      }

      function initWeather() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              fetchWeather(pos.coords.latitude, pos.coords.longitude);
            },
            (err) => {
              console.warn("Geolocation error", err);
              fetchWeather(9.9312, 76.2673); // fallback: Kochi
            }
          );
        } else {
          fetchWeather(9.9312, 76.2673);
        }
      }

      // Language switch
      function malyalam() {
        window.location.href = "malyalam.html";
      }

      renderCrops();
      initWeather();

      // Voice input in Malayalam
      const voiceBtn = document.getElementById("voiceBtn");
      voiceBtn.addEventListener("click", () => {
        if (
          !("webkitSpeechRecognition" in window) &&
          !("SpeechRecognition" in window)
        ) {
          alert("เดจเดฟเดเตเดเดณเตเดเต เดฌเตเดฐเตเดธเตผ เดถเดฌเตเดฆ เดคเดฟเดฐเดฟเดเตเดเดฑเดฟเดฏเตฝ เดชเดฟเดจเตเดคเตเดฃเดฏเตเดเตเดเตเดจเตเดจเดฟเดฒเตเดฒ.");
          return;
        }

        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = "ml-IN"; // Malayalam
        recognition.interimResults = false;

        recognition.onstart = () =>
          console.log("เดถเดฌเตเดฆ เดคเดฟเดฐเดฟเดเตเดเดฑเดฟเดฏเตฝ เดเดฐเดเดญเดฟเดเตเดเต...");
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          document.querySelector(
            ".chat-box"
          ).innerHTML += `<div>เดเดชเดฏเตเดเตเดคเดพเดตเต: ${transcript}</div>`;
        };

        recognition.onerror = (event) =>
          console.error("เดถเดฌเตเดฆ เดคเดฟเดฐเดฟเดเตเดเดฑเดฟเดฏเตฝ เดชเดฟเดดเดตเต:", event.error);
        recognition.start();
      });

      // Photo capture in Malayalam
      const photoBtn = document.getElementById("photoBtn");
      const capturedMediaDiv = document.getElementById("capturedMedia");

      photoBtn.addEventListener("click", async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();
          capturedMediaDiv.innerHTML = "";
          capturedMediaDiv.appendChild(video);

          // Snapshot button
          const snapBtn = document.createElement("button");
          snapBtn.textContent = "๐ธ เดซเตเดเตเดเต เดชเดฟเดเดฟเดเตเดเตเด";
          capturedMediaDiv.appendChild(snapBtn);

          snapBtn.addEventListener("click", () => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const img = document.createElement("img");
            img.src = canvas.toDataURL("image/png");
            capturedMediaDiv.innerHTML = "";
            capturedMediaDiv.appendChild(img);

            // Stop camera
            stream.getTracks().forEach((track) => track.stop());
          });
        } catch (err) {
          console.error("เดเตเดฏเดพเดฎเดฑ เดเดเตโเดธเดธเต เดชเดฟเดดเดตเต:", err);
          alert("เดเตเดฏเดพเดฎเดฑเดฏเตเดเตเดเต เดเดเตโเดธเดธเต เดธเดพเดงเตเดฏเดฎเดฒเตเดฒ.");
        }
      });

      function english() {
        window.location.href = "chatbot.html";
      }
    </script>
  </body>
</html>
